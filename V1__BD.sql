;             
CREATE USER IF NOT EXISTS SA SALT '87e77c66c7ec4333' HASH 'a829a7e3a47e04dcf620cf886402c8c3abbc12d84beb21e941e1312fcf47013e' ADMIN;           
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_87700A4F_E94F_41C2_BBED_8D4E46D25EFB START WITH 3 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_B4527867_FFBF_4D3A_8539_FB47EBC2CEFB START WITH 2 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_A6FEF1F5_6AF0_4FEF_9957_B10BB2821CCC START WITH 9 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_0EBB7A13_8A90_4ED5_961F_FE9DFD5DDB8C START WITH 3 BELONGS_TO_TABLE;    
CREATE CACHED TABLE PUBLIC.AUTH(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_A6FEF1F5_6AF0_4FEF_9957_B10BB2821CCC) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_A6FEF1F5_6AF0_4FEF_9957_B10BB2821CCC,
    NAME VARCHAR(64) NOT NULL,
    PASSWORD VARCHAR(64) NOT NULL,
    LOGIN VARCHAR(32) NOT NULL,
    SALT VARCHAR(32) NOT NULL
);      
ALTER TABLE PUBLIC.AUTH ADD CONSTRAINT PUBLIC.CONSTRAINT_1 PRIMARY KEY(ID);   
-- 8 +/- SELECT COUNT(*) FROM PUBLIC.AUTH;    
INSERT INTO PUBLIC.AUTH(ID, NAME, PASSWORD, LOGIN, SALT) VALUES
(1, 'Valera', '3b7aaba10b5bd68a1a8c2205ff0bb835', 'arxangel', 'ololo'),
(2, 'Kolya', '6b75670a96fb29dee08a34ce0e1e5688', 'Oracle', '5hTt3h76t2'),
(3, 'Victor', 'dce5e9972ee1fe72dec0258071d41a00', 'PowPow', 'pp54tyu61h'),
(4, 'Alexey', 'ecd05256712412e97c7bb97f820cc6d8', 'SClumba22', '25gty5y8wd'),
(5, 'Oleg', '4fa169d0996cb699d50645fbe1e27f93', 'SolDlyaVann', 'bn6kd18p89'),
(6, 'Vitaly', '76426cf1f9428154b3e4d817d660f296', 'VaitalyaSuper', 'u6p423hpd9'),
(7, 'John Doe', 'd4dcb360ec4163805e5ffb70fb684cb5', 'jdoe', 'dfgdfg3324terwt345as1'),
(8, 'Jane Row', 'a440866eb82b8ac87d45b8cade0dc028', 'jrow', '47fdp341jfdg45');       
CREATE CACHED TABLE PUBLIC.RESOURCE(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_0EBB7A13_8A90_4ED5_961F_FE9DFD5DDB8C) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_0EBB7A13_8A90_4ED5_961F_FE9DFD5DDB8C,
    NAME VARCHAR(64) NOT NULL,
    ID_PARENT INT DEFAULT NULL
);

ALTER TABLE PUBLIC.RESOURCE ADD CONSTRAINT PUBLIC.CONSTRAINT_1A PRIMARY KEY(ID);              
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.RESOURCE;
INSERT INTO PUBLIC.RESOURCE(ID, NAME, ID_PARENT) VALUES
(1, 'a', NULL),
(2, 'a.b', 1);      
CREATE CACHED TABLE PUBLIC.ACCAU(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_87700A4F_E94F_41C2_BBED_8D4E46D25EFB) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_87700A4F_E94F_41C2_BBED_8D4E46D25EFB,
    ROLE VARCHAR(32) NOT NULL,
    AUTH_ID INT NOT NULL,
    DATE_IN DATE NOT NULL,
    DATE_OUT DATE NOT NULL,
    VOLUME INT DEFAULT '0' NOT NULL,
    RES_ID INT
);               
ALTER TABLE PUBLIC.ACCAU ADD CONSTRAINT PUBLIC.CONSTRAINT_3 PRIMARY KEY(ID);  
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.ACCAU;   
INSERT INTO PUBLIC.ACCAU(ID, ROLE, AUTH_ID, DATE_IN, DATE_OUT, VOLUME, RES_ID) VALUES
(1, 'read', 7, DATE '2015-05-01', DATE '2015-05-02', 100, 1),
(2, 'read', 7, DATE '2015-05-01', DATE '2015-05-02', 100, 1);           
CREATE CACHED TABLE PUBLIC.RES_USER(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_B4527867_FFBF_4D3A_8539_FB47EBC2CEFB) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_B4527867_FFBF_4D3A_8539_FB47EBC2CEFB,
    RES_ID INT NOT NULL,
    AUTH_ID INT NOT NULL,
    ROLE VARCHAR(32) NOT NULL
);  
ALTER TABLE PUBLIC.RES_USER ADD CONSTRAINT PUBLIC.CONSTRAINT_1B PRIMARY KEY(ID);              
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.RES_USER;
INSERT INTO PUBLIC.RES_USER(ID, RES_ID, AUTH_ID, ROLE) VALUES
(1, 1, 7, 'read');             
ALTER TABLE PUBLIC.AUTH ADD CONSTRAINT PUBLIC.LOGIN UNIQUE(LOGIN);            
ALTER TABLE PUBLIC.RESOURCE ADD CONSTRAINT PUBLIC.NAME UNIQUE(NAME);          
ALTER TABLE PUBLIC.RES_USER ADD CONSTRAINT PUBLIC.RES_ID_AUTH_ID_ROLE UNIQUE(RES_ID, AUTH_ID, ROLE);          
ALTER TABLE PUBLIC.ACCAU ADD CONSTRAINT PUBLIC.CONSTRAINT_3B FOREIGN KEY(AUTH_ID) REFERENCES PUBLIC.AUTH(ID) ON DELETE CASCADE NOCHECK;       
ALTER TABLE PUBLIC.RES_USER ADD CONSTRAINT PUBLIC.CONSTRAINT_1B33 FOREIGN KEY(AUTH_ID) REFERENCES PUBLIC.AUTH(ID) ON DELETE CASCADE NOCHECK;  
ALTER TABLE PUBLIC.ACCAU ADD CONSTRAINT PUBLIC.CONSTRAINT_3B3 FOREIGN KEY(RES_ID) REFERENCES PUBLIC.RESOURCE(ID) ON DELETE CASCADE NOCHECK;   
ALTER TABLE PUBLIC.RESOURCE ADD CONSTRAINT PUBLIC.CONSTRAINT_1A5 FOREIGN KEY(ID_PARENT) REFERENCES PUBLIC.RESOURCE(ID) ON DELETE CASCADE NOCHECK;             
ALTER TABLE PUBLIC.RES_USER ADD CONSTRAINT PUBLIC.CONSTRAINT_1B3 FOREIGN KEY(RES_ID) REFERENCES PUBLIC.RESOURCE(ID) ON DELETE CASCADE NOCHECK;
